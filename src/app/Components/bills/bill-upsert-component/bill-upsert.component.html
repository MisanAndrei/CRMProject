<div class="header">
  <h1>Factura noua</h1>
</div>
<form [formGroup]="transactionForm" (ngSubmit)="onSubmit()">
  <div>
    <h4>Detalii de facturare</h4>
    <h6 class="descr-subsection">
      Detaliile de facturare apar în factura ta. Data facturii este utilizată în
      tabloul de bord și în rapoarte.
    </h6>
    <div class="separator-line"></div>

    <div class="subsection">
      <div class="align-content">
        <div class="inputs-container">
          <label for="transactionType">Tipul Tranzacției</label>
          <select id="transactionType" formControlName="transactionType">
            <option value="purchase">Cumpărare</option>
            <option value="sale">Vânzare</option>
          </select>
        </div>

        <div class="inputs-container">
          <label for="category">Categorie</label>
          <select
            id="category"
            formControlName="category"
            (change)="onCategoryChange($event)"
          >
            <option value="">Selectează Categorie</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="align-content">
        <div class="inputs-container">
          <label for="dateOfBill">Data Facturii</label>
          <input id="dateOfBill" formControlName="dateOfBill" type="date" />
        </div>

        <div class="inputs-container">
          <label for="dueDate">Data Scadentă</label>
          <input id="dueDate" formControlName="dueDate" type="date" />
        </div>
      </div>

      <div class="align-content">
        <div class="inputs-container">
          <label for="numberOfBill">Numărul Facturii</label>
          <input
            id="numberOfBill"
            formControlName="numberOfBill"
            type="text"
            placeholder="Introduceți Numărul Facturii"
          />
        </div>

        <div class="inputs-container">
          <label for="orderNumber">Număr de Comandă</label>
          <input
            id="orderNumber"
            formControlName="orderNumber"
            type="text"
            placeholder="Introduceți Număr de Comandă"
          />
        </div>
      </div>

      <div class="align-content">
        <div class="inputs-container">
          <label for="partner">Partener</label>
          <select
            id="partner"
            formControlName="partner"
            (change)="onPartnerChange($event)"
          >
            <option value="">Selectează Partener</option>
            <option *ngFor="let partner of partners" [value]="partner.id">
              {{ partner.name }}
            </option>
          </select>
        </div>
        <div class="inputs-container plus-button">
          <button
            mat-raised-button
            (click)="addPartner()"
            class="no-shadow-button"
          >
            <mat-icon>person_add</mat-icon>
            Adaugă partener nou
          </button>
        </div>
      </div>

      <div class="double-input-container">
        <div class="input-wrapper">
          <label for="partnerName">Nume Partener</label>
          <input
            id="partnerName"
            formControlName="partnerName"
            type="text"
            [disabled]="!transactionForm.get('partnerName')?.enabled"
            placeholder="Introduceți Nume Partener"
          />
        </div>
        <div class="input-wrapper">
          <label for="customerCui">CUI</label>
          <input
            id="customerCui"
            formControlName="customerCui"
            type="text"
            [disabled]="!transactionForm.get('customerCui')?.enabled"
            placeholder="Introduceți CUI"
          />
        </div>

        <div class="input-wrapper">
          <label for="customerCity">Oraș</label>
          <input
            id="customerCity"
            formControlName="customerCity"
            type="text"
            [disabled]="!transactionForm.get('customerCity')?.enabled"
            placeholder="Introduceți Oraș"
          />
        </div>
      </div>
    </div>
  </div>
  <div class="section-delimiter">
    <h4>Articole</h4>
    <h6 class="descr-subsection">Adaugă elementele asociate facturii.</h6>
    <div class="separator-line"></div>

    <div class="subsection">
      <label for="items">Articole</label>
      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index">
          <div [formGroupName]="i" class="item-fields">
            <select formControlName="selectedItem" (change)="onItemChange(i)">
              <option value="">Adaugă</option>
              <option *ngFor="let element of elements" [value]="element.id">
                {{ element.name }}
              </option>
            </select>

            <input
              formControlName="elementDescription"
              placeholder="Descriere"
              type="text"
              [disabled]="true"
            />
            <input
              formControlName="quantity"
              placeholder="Cantitate"
              type="number"
              (change)="onQuantityOrPriceChange(i)"
            />
            <input
              formControlName="elementPrice"
              placeholder="Preț"
              type="number"
              [disabled]="true"
            />
            <input
              formControlName="elementTax"
              placeholder="Taxă"
              type="number"
              (change)="onTaxChange(i)"
              [disabled]="false"
            />
            <input
              formControlName="total"
              placeholder="Total"
              type="text"
              [disabled]="true"
            />
          </div>
          <button type="button" (click)="addItem()" class="elements-button">
            Adaugă element
          </button>
          <div class="buttons-container">
            <button type="button" (click)="removeItem(i)" class="remove-button">
              Anulează
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="overall-total">
      <label for="overallTotal">Total:</label>
      <input id="overallTotal" [value]="overallTotal.toFixed(2)" disabled />
    </div>
  </div>

  <div class="button-container">
    <button type="submit" class="submit-button">
      {{ isPurchase() ? 'Creează achiziție' : 'Creează vânzare' }}
    </button>
  </div>
</form>
